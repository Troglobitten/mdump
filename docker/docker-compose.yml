version: '3.8'

services:
  mdump:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: mdump
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - ./data/notes:/data/notes
      - ./data/config:/data/config
      - ./data/.image-cache:/data/.image-cache
      # Optional: Mount TLS certificates for HTTPS
      # - /path/to/certs:/data/certs:ro
    environment:
      - NODE_ENV=production
      - DATA_DIR=/data
      - NOTES_DIR=/data/notes
      - PORT=8080
      - SESSION_SECRET=${SESSION_SECRET:-change-me-in-production}
      # Optional: Enable HTTPS by providing paths to TLS cert and key inside the container
      # - TLS_CERT=/data/certs/cert.pem
      # - TLS_KEY=/data/certs/key.pem
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/api/auth/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

