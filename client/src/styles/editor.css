/* Milkdown Crepe theme imports */
@import '@milkdown/crepe/theme/common/style.css';
@import '@milkdown/crepe/theme/frame.css';

/* Theme Switching Logic:
   - When mdump themed editor is DISABLED: Use Milkdown's frame theme (current behavior)
   - When mdump themed editor is ENABLED: Use DaisyUI theme colors
   - Focus theme exception: Always use light editor
*/

/* === MILKDOWN THEMED (Disabled - use Milkdown's own themes) === */

/* Light mode with Milkdown theme */
html[data-mdump-themed-editor="false"][data-theme-mode="light"] .milkdown {
  /* Uses default frame.css (already imported) */
}

/* Dark mode with Milkdown theme */
html[data-mdump-themed-editor="false"][data-theme-mode="dark"] .milkdown {
  --crepe-color-background: #1a1a1a;
  --crepe-color-on-background: #e6e6e6;
  --crepe-color-surface: #121212;
  --crepe-color-surface-low: #1c1c1c;
  --crepe-color-on-surface: #d1d1d1;
  --crepe-color-on-surface-variant: #a9a9a9;
  --crepe-color-outline: #757575;
  --crepe-color-primary: #b5b5b5;
  --crepe-color-secondary: #4d4d4d;
  --crepe-color-on-secondary: #d6d6d6;
  --crepe-color-inverse: #e5e5e5;
  --crepe-color-on-inverse: #2a2a2a;
  --crepe-color-inline-code: #ff6666;
  --crepe-color-error: #ff6666;
  --crepe-color-hover: #232323;
  --crepe-color-selected: #2f2f2f;
  --crepe-color-inline-area: #2b2b2b;

  --crepe-shadow-1:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3),
    0px 1px 3px 1px rgba(255, 255, 255, 0.15);
  --crepe-shadow-2:
    0px 1px 2px 0px rgba(255, 255, 255, 0.3),
    0px 2px 6px 2px rgba(255, 255, 255, 0.15);
}

/* Focus theme with Milkdown theme (light editor on dark UI) */
html[data-mdump-themed-editor="false"][data-theme-mode="focus"] .milkdown {
  /* Uses default frame.css (light theme) */
}

/* === MDUMP THEMED (Enabled - use DaisyUI colors) === */

/* Light themes with DaisyUI colors */
html[data-mdump-themed-editor="true"][data-theme-mode="light"] .milkdown {
  --crepe-color-background: oklch(var(--b1));
  --crepe-color-on-background: oklch(var(--bc));
  --crepe-color-surface: oklch(var(--b2));
  --crepe-color-surface-low: oklch(var(--b3));
  --crepe-color-on-surface: oklch(var(--bc));
  --crepe-color-on-surface-variant: color-mix(in oklch, oklch(var(--bc)), transparent 30%);
  --crepe-color-outline: oklch(var(--bc) / 0.4);
  --crepe-color-primary: oklch(var(--p));
  --crepe-color-secondary: oklch(var(--s));
  --crepe-color-on-secondary: oklch(var(--sc));
  --crepe-color-inverse: oklch(var(--b3));
  --crepe-color-on-inverse: oklch(var(--bc));
  --crepe-color-inline-code: oklch(var(--er));
  --crepe-color-error: oklch(var(--er));
  --crepe-color-hover: color-mix(in oklch, oklch(var(--b2)), oklch(var(--bc)) 5%);
  --crepe-color-selected: color-mix(in oklch, oklch(var(--b2)), oklch(var(--bc)) 10%);
  --crepe-color-inline-area: oklch(var(--b3));
}

/* Dark themes with DaisyUI colors */
html[data-mdump-themed-editor="true"][data-theme-mode="dark"] .milkdown {
  --crepe-color-background: oklch(var(--b1));
  --crepe-color-on-background: oklch(var(--bc));
  --crepe-color-surface: oklch(var(--b2));
  --crepe-color-surface-low: oklch(var(--b3));
  --crepe-color-on-surface: oklch(var(--bc));
  --crepe-color-on-surface-variant: color-mix(in oklch, oklch(var(--bc)), transparent 30%);
  --crepe-color-outline: oklch(var(--bc) / 0.4);
  --crepe-color-primary: oklch(var(--p));
  --crepe-color-secondary: oklch(var(--s));
  --crepe-color-on-secondary: oklch(var(--sc));
  --crepe-color-inverse: oklch(var(--b3));
  --crepe-color-on-inverse: oklch(var(--bc));
  --crepe-color-inline-code: oklch(var(--er));
  --crepe-color-error: oklch(var(--er));
  --crepe-color-hover: color-mix(in oklch, oklch(var(--b2)), oklch(var(--bc)) 5%);
  --crepe-color-selected: color-mix(in oklch, oklch(var(--b2)), oklch(var(--bc)) 10%);
  --crepe-color-inline-area: oklch(var(--b3));
}

/* Focus theme with DaisyUI colors (EXCEPTION: keep light editor) */
html[data-mdump-themed-editor="true"][data-theme-mode="focus"] .milkdown {
  /* Use light Milkdown theme (frame.css default) - don't theme it */
  /* This preserves the contrast of light editor on dark UI */
}

/* Editor container layout */
.editor-wrap {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}

.editor-wrap > div {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

/* Vertical spacing using --spacing-factor custom property */
/* This will be set by useSettings.ts like before */
.editor-wrap .ProseMirror {
  --spacing-factor: 0.35;
}

.editor-wrap .ProseMirror h1 {
  margin-top: calc(1.5rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror h2 {
  margin-top: calc(1.25rem * var(--spacing-factor));
  margin-bottom: calc(0.75rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror h3 {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(0.5rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror p {
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror ul,
.editor-wrap .ProseMirror ol {
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror li {
  margin-bottom: calc(0.25rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror blockquote {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror pre {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror img {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror hr {
  margin-top: calc(1.5rem * var(--spacing-factor));
  margin-bottom: calc(1.5rem * var(--spacing-factor));
}

.editor-wrap .ProseMirror table {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: max(1rem, calc(1rem * var(--spacing-factor)));
}

/* Print styles */
@media print {
  /* Hide all UI chrome */
  aside,
  .tab-bar,
  .resize-handle,
  .toast-container,
  .modal-backdrop,
  .context-menu {
    display: none !important;
  }

  /* Hide toolbar, breadcrumb, attachment bar */
  .milkdown-toolbar,
  .breadcrumb,
  .attachment-bar {
    display: none !important;
  }

  /* Remove viewport constraints */
  html, body, #app {
    height: auto !important;
    width: auto !important;
    overflow: visible !important;
  }

  /* Remove all flex/overflow constraints */
  #app > div,
  #app > div > div,
  main,
  main > div,
  .editor-wrap,
  .editor-wrap > div {
    height: auto !important;
    overflow: visible !important;
    display: block !important;
  }

  /* Let ProseMirror content flow naturally */
  .editor-wrap .ProseMirror {
    overflow: visible !important;
    height: auto !important;
  }

  /* Print-friendly typography */
  body {
    background: white !important;
    color: black !important;
  }

  .editor-wrap,
  .editor-wrap .ProseMirror {
    background: white !important;
    color: black !important;
  }

  /* Remove borders/outlines */
  .editor-wrap,
  .editor-wrap > div,
  .editor-wrap .ProseMirror {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    padding: 0 !important;
  }

  /* Force print backgrounds */
  .editor-wrap * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Headings */
  .editor-wrap h1,
  .editor-wrap h2,
  .editor-wrap h3,
  .editor-wrap h4,
  .editor-wrap h5,
  .editor-wrap h6 {
    color: black !important;
    page-break-after: avoid;
  }

  /* Links */
  .editor-wrap a {
    color: #1a0dab !important;
    text-decoration: underline !important;
  }

  /* Code blocks */
  .editor-wrap pre {
    background: #f0f0f0 !important;
    border: 1px solid #d0d0d0 !important;
    color: black !important;
    page-break-inside: avoid;
  }

  .editor-wrap code {
    background: #f0f0f0 !important;
    color: black !important;
  }

  .editor-wrap pre code {
    background: transparent !important;
  }

  /* Blockquotes */
  .editor-wrap blockquote {
    border-left-color: #999 !important;
    color: #333 !important;
  }

  /* Tables */
  .editor-wrap table {
    border-collapse: collapse !important;
  }

  .editor-wrap th {
    background: #e8e8e8 !important;
    color: #1a1a1a !important;
    font-weight: 600 !important;
    border: 1px solid #aaa !important;
  }

  .editor-wrap td {
    border: 1px solid #aaa !important;
    color: black !important;
  }

  /* Images */
  .editor-wrap img {
    max-width: 100% !important;
    page-break-inside: avoid;
  }
}
