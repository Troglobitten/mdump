/* Wysimark editor theme overrides */

/* Dark mode: Override Wysimark's hardcoded light-mode CSS variables.
   Scoped to .editor-wrap so Wysimark's tooltip portals (rendered on document.body)
   inherit the original light-mode shade values with good contrast. */
html[data-theme-mode="dark"] .editor-wrap {
  --shade-50: oklch(var(--b2, 0.25 0 0));
  --shade-100: oklch(var(--b3, 0.22 0 0));
  --shade-200: oklch(var(--b3, 0.22 0 0));
  --shade-300: oklch(var(--bc, 0.85 0 0) / 0.3);
  --shade-400: oklch(var(--bc, 0.85 0 0) / 0.5);
  --shade-500: oklch(var(--bc, 0.85 0 0) / 0.6);
  --shade-600: oklch(var(--bc, 0.85 0 0) / 0.7);
  --shade-700: oklch(var(--bc, 0.85 0 0) / 0.8);
  --shade-800: oklch(var(--bc, 0.85 0 0) / 0.9);
  --shade-900: oklch(var(--bc, 0.85 0 0));
  --blue-50: oklch(var(--b2, 0.25 0 0));
  --blue-100: oklch(var(--b3, 0.22 0 0));
  --code-block-bgcolor: oklch(var(--b2, 0.25 0 0));
  --code-block-color: oklch(var(--bc, 0.85 0 0));
}

/* Focus theme: Keep light editor area (dark chrome, light editor) */
html[data-theme-mode="focus"] .editor-wrap {
  --shade-50: rgb(250 250 250);
  --shade-100: rgb(245 245 245);
  --shade-200: rgb(229 229 229);
  --shade-300: rgb(212 212 212);
  --code-block-bgcolor: rgb(245 245 245);
  --code-block-color: rgb(39 39 42);
}

/* Editor container */
.wysimark {
  @apply h-full flex flex-col;
}

/* Toolbar */
.wysimark-toolbar {
  @apply flex items-center gap-1 px-3 py-2 border-b border-base-300 bg-base-200 flex-wrap;
}

.wysimark-toolbar button {
  @apply p-1.5 rounded hover:bg-base-300 transition-colors;
}

.wysimark-toolbar button.active {
  @apply bg-primary/20 text-primary;
}

.wysimark-toolbar-separator {
  @apply w-px h-6 bg-base-300 mx-1;
}

/* Editor content area */
.wysimark-editor {
  @apply flex-1 overflow-auto p-4;
}

/* Vertical spacing — controlled via --spacing-factor custom property (set by JS).
   compact = 0.15, default = 0.35, comfortable = 0.6 */
.editor-wrap [data-slate-editor] {
  --spacing-factor: 0.35;
}

.editor-wrap [data-slate-editor] h1 {
  margin-top: calc(1.5rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] h2 {
  margin-top: calc(1.25rem * var(--spacing-factor));
  margin-bottom: calc(0.75rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] h3 {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(0.5rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] p {
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] ul,
.editor-wrap [data-slate-editor] ol {
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] li {
  margin-bottom: calc(0.25rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] blockquote {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] pre {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] img {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: calc(1rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] hr {
  margin-top: calc(1.5rem * var(--spacing-factor));
  margin-bottom: calc(1.5rem * var(--spacing-factor));
}

.editor-wrap [data-slate-editor] table {
  margin-top: calc(1rem * var(--spacing-factor));
  margin-bottom: max(1rem, calc(1rem * var(--spacing-factor)));
}

/* For focus theme - light editor on dark chrome */
[data-theme='focus'] .wysimark-editor {
  @apply bg-white text-gray-900;
}

[data-theme='focus'] .wysimark-editor ::selection {
  @apply bg-primary/30;
}

/* Typography in editor */
.wysimark-editor h1 {
  @apply text-3xl font-bold mb-4 mt-6 first:mt-0;
}

.wysimark-editor h2 {
  @apply text-2xl font-semibold mb-3 mt-5 first:mt-0;
}

.wysimark-editor h3 {
  @apply text-xl font-medium mb-2 mt-4 first:mt-0;
}

.wysimark-editor p {
  @apply mb-4 leading-relaxed;
}

.wysimark-editor ul,
.wysimark-editor ol {
  @apply mb-4 pl-6;
}

.wysimark-editor ul {
  @apply list-disc;
}

.wysimark-editor ol {
  @apply list-decimal;
}

.wysimark-editor li {
  @apply mb-1;
}

.wysimark-editor blockquote {
  @apply border-l-4 border-primary pl-4 italic my-4 text-base-content/80;
}

.wysimark-editor code {
  @apply bg-base-200 px-1.5 py-0.5 rounded text-sm font-mono;
}

[data-theme='focus'] .wysimark-editor code {
  @apply bg-gray-100 text-gray-800;
}

.wysimark-editor pre {
  @apply bg-base-200 p-4 rounded-lg overflow-x-auto my-4;
}

[data-theme='focus'] .wysimark-editor pre {
  @apply bg-gray-100;
}

.wysimark-editor pre code {
  @apply bg-transparent p-0;
}

.wysimark-editor a {
  @apply text-primary hover:underline;
}

.wysimark-editor img {
  @apply max-w-full h-auto rounded-lg my-4;
}

.wysimark-editor hr {
  @apply border-base-300 my-6;
}

.wysimark-editor table {
  @apply w-full border-collapse my-4;
}

.wysimark-editor th,
.wysimark-editor td {
  @apply border border-base-300 px-3 py-2 text-left;
}

.wysimark-editor th {
  @apply bg-base-200 font-semibold;
}

[data-theme='focus'] .wysimark-editor th {
  @apply bg-gray-100;
}

/* Task list */
.wysimark-editor input[type='checkbox'] {
  @apply mr-2 checkbox checkbox-sm;
}

/* Placeholder */
.wysimark-editor [data-placeholder]::before {
  @apply text-base-content/40 pointer-events-none;
  content: attr(data-placeholder);
}

/* Image upload loading state */
.wysimark-editor .image-uploading {
  @apply opacity-50 animate-pulse;
}

/* Link popup */
.wysimark-link-popup {
  @apply bg-base-100 border border-base-300 rounded-lg shadow-xl p-3;
}

.wysimark-link-popup input {
  @apply input input-bordered input-sm w-full;
}

/* Dropdown menus */
.wysimark-dropdown {
  @apply bg-base-100 border border-base-300 rounded-lg shadow-xl py-1 min-w-32;
}

.wysimark-dropdown-item {
  @apply px-3 py-1.5 hover:bg-base-200 cursor-pointer;
}

.wysimark-dropdown-item.active {
  @apply bg-primary/20 text-primary;
}

/* ===== Print styles ===== */
@media print {
  /* Hide all UI chrome */
  aside,
  .tab-bar,
  .resize-handle,
  .toast-container,
  .modal-backdrop,
  .context-menu {
    display: none !important;
  }

  /* Hide editor toolbar (Wysimark toolbar wrapper) */
  .editor-wrap > div > div > div:first-child {
    display: none !important;
  }

  /* Hide everything in the editor column except the editor itself:
     breadcrumb, attachment bar, hidden file inputs, modals.
     Uses general sibling and the parent's children via :has(). */
  .editor-wrap ~ * {
    display: none !important;
  }

  /* Hide breadcrumb and attachment bar (siblings before .editor-wrap).
     They are direct children of the EditorContainer root alongside .editor-wrap. */
  *:has(> .editor-wrap) > *:not(.editor-wrap) {
    display: none !important;
  }

  /* Remove viewport constraints so full content prints */
  html, body, #app {
    height: auto !important;
    width: auto !important;
    overflow: visible !important;
  }

  /* Remove all flex/overflow constraints through the component tree */
  #app > div,
  #app > div > div,
  main,
  main > div,
  .editor-wrap,
  .editor-wrap > div,
  .editor-wrap > div > div {
    height: auto !important;
    overflow: visible !important;
    display: block !important;
  }

  /* Let the Slate editor content flow naturally */
  .editor-wrap [data-slate-editor] {
    overflow: visible !important;
    height: auto !important;
  }

  /* Print-friendly typography — black on white regardless of theme */
  body {
    background: white !important;
    color: black !important;
  }

  .editor-wrap,
  .editor-wrap [data-slate-editor] {
    background: white !important;
    color: black !important;
  }

  /* Remove all borders/outlines from editor containers and Wysimark focus ring.
     Wysimark uses --select-editor-color for the focus outline via Emotion (runtime),
     so we neutralize the variable itself to avoid specificity battles. */
  .editor-wrap,
  .editor-wrap > div,
  .editor-wrap > div > div,
  .editor-wrap > div > div > div,
  .editor-wrap .--focused {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    --select-editor-color: transparent !important;
    --select-color: transparent !important;
  }

  .editor-wrap [data-slate-editor] {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
    padding: 0 !important;
  }

  /* Force browsers to print backgrounds (for code blocks, table headers, emojis) */
  .editor-wrap * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Headings */
  .editor-wrap h1,
  .editor-wrap h2,
  .editor-wrap h3,
  .editor-wrap h4,
  .editor-wrap h5,
  .editor-wrap h6 {
    color: black !important;
    page-break-after: avoid;
  }

  /* Links — show URL and use dark color */
  .editor-wrap a {
    color: #1a0dab !important;
    text-decoration: underline !important;
  }

  /* Code blocks — light gray background */
  .editor-wrap pre {
    background: #f0f0f0 !important;
    border: 1px solid #d0d0d0 !important;
    color: black !important;
    page-break-inside: avoid;
  }

  /* Inline code — light gray background */
  .editor-wrap code {
    background: #f0f0f0 !important;
    color: black !important;
  }

  /* Code inside pre blocks — transparent so pre background shows through */
  .editor-wrap pre code {
    background: transparent !important;
  }

  /* Code block language label: hide the dropdown chrome, show only the text.
     Wysimark renders a contentEditable=false <span> (position: absolute, top-right)
     inside each code block div, containing a <span> with the language name
     and an SVG chevron. Target via the parent div that :has a [spellcheck=false]
     descendant (unique to code block lines). */
  .editor-wrap div:has([spellcheck="false"]) > span[contenteditable="false"] {
    background: transparent !important;
    cursor: default !important;
    color: #888 !important;
    font-size: 0.7em !important;
    padding: 0.25em 0.5em !important;
  }

  /* Hide the dropdown chevron SVG */
  .editor-wrap div:has([spellcheck="false"]) > span[contenteditable="false"] svg {
    display: none !important;
  }

  /* Blockquotes */
  .editor-wrap blockquote {
    border-left-color: #999 !important;
    color: #333 !important;
  }

  /* Tables */
  .editor-wrap table {
    border-collapse: collapse !important;
  }

  /* Table headers — light gray background with dark contrasting text */
  .editor-wrap th {
    background: #e8e8e8 !important;
    color: #1a1a1a !important;
    font-weight: 600 !important;
    border: 1px solid #aaa !important;
  }

  .editor-wrap td {
    border: 1px solid #aaa !important;
    color: black !important;
  }

  /* Images */
  .editor-wrap img {
    max-width: 100% !important;
    page-break-inside: avoid;
  }

  /* Override Wysimark CSS variable-based colors for print */
  .editor-wrap {
    --shade-50: #fafafa;
    --shade-100: #f5f5f5;
    --shade-200: #e5e5e5;
    --shade-300: #d4d4d4;
    --shade-400: #a3a3a3;
    --shade-500: #737373;
    --shade-600: #525252;
    --shade-700: #404040;
    --shade-800: #262626;
    --shade-900: #171717;
    --blue-50: #eff6ff;
    --blue-100: #dbeafe;
    --code-block-bgcolor: #f0f0f0;
    --code-block-color: #171717;
  }
}
